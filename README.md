# Простая модель работы лифта

Пусть дом имеет n этажей (все номера положительные, нумерация начинается с единицы). Лифт перемещается между этажами и развозит жителей, которые случайным образом появляются на разных этажах.

Лифт работает в терх режимах: движение вверх, вниз и нейтральное состояние. Переключение направления происходит, когда в лифте не остается пассажиров, которым нужно двигаться в заданном направлении. Нейтральное состояние достигаеться, когда в лифте больше нет пассажиров, а также отсутствуют текущие вызовы лифта.

## lift on startup

Программа lift.cpp создает очередь сообщений {} и разделяемую память {}. Разделяемая память - это массив int'ов. В 0-й ячейке находится минимальный номер этажа, среди этажей, на которые хотят попасть пассажиры, находящиеся в лифте (в каждый момент все пассажиры в лифте двигаются в одном направлении) и этажей, с которых был совершен вызов лифта. В 1-ой ячейке соответственно находится максимальный номер этажа. В ячейке (2n) находится число жителей, нажавших кпопку "вниз" на n-ом этаже. В ячейке (2n + 1) находится число жителей, нажавших кнопку "вверх" на n-ом этаже. В ячейке (2*MAX_FLOOR + 1 + n) находится число жителей, желающих высадиться на n-ом этаже.

## citizens_generator

Программа citizens_generator использует генератор случайных чисел, чтобы выбрать этаж на котором будет сгенерирован очередной житель, а также определить этаж, на который этот житель хочет попасть. Сгенерировав числа, citizens_generator, используя комбинацию fork() и exec(), запускает очередной процесс, исполняющий программу citizen, который имитирует жителя.

## citizen

Когда очередной житель сгенерирован, программа cittizen подключается к очереди сообщений и получает доступ к разделяемой памяти. Когда очередной житель нажимает кпопку, программа citizen отправляет сообщение типа 1, с текстом "up" или "down", которое считывается лифтом. Также citizen увеличивает на единицу количество людей, ожидающих лифт в определенном направлении на данном этаже (на единицу увеличивается значение соответствующей ячейки памяти). Когда лифт приезжает на этаж, на котором его ждут пользователи, программа lift отправляет пустое сообщение типа 2, если лифт едет вниз, или пустое сообщение типа 3, если лифт едет вверх. Житель, который хочет двигаться в направлении, соответствующем режиму работы лифта, читает сообщение, затем в соответствующей ячеке разделяемой памяти уменьшает количество ожидающих на данном этаже, потом пересылает это сообщение (если на этаже все еще есть жители, которые хотят зайти в лифт в данный момент) и начинает процедуру входа в лифт. Процедура входа заключается в том, что житель отправляет сообщение типа 4 с номером этажа, на который этот житель хочет попасть. Лифт в цикле считывает такие сообщения. Когда все жители зашли в лифт, он едет дальше. Когда лифт приезжает на этаж, на котором пассажиры хотят выйти, лифт отправляет сообщение типа (4 + текущий номер этажа), которое считывается пассажиром и пересылается дальше. После выхода из лифта процесс, исполняющий программу citizen, завершает свою работу.

## workflow of lift

В момент запуска, лифт находится на 1-ом этаже в нейтральном состоянии и ожидает сообщения типа 1, как только хотябы одно такое сообщение получено, lift в цикле считывает все сообщения типа 1, пока очередь не будет пуста. Проезжая очередной этаж лифт снова в цикле пытается считать все новые отпраленные вызовы. Затем лифт проверяет, нужно ли останавливаться на текущем этаже, и, если нужно, то начинается загрузка пассажирова, иначе лифт едет на следующий этаж.




<!-- 
Когда очередной житель сгенерирован, программа cittizen подключается к очереди сообщений и получает доступ к разделяемой памяти. Когда
очередной житель нажимает кпопку, программа citizen отправляет сообщение типа 1, с текстом "up" или "down", которое считывается лифтом.
Когда лифт приезжает на этаж, на котором его ждут пользователи, программа lift отправляет сообщение типа 2 с текстом "up" или "down".
При считывании сообщения жителем, который хочет двигаться в направлении, которое не соответствует текущему режиму работы лифта, этот
житель просто пересылвает это сообщение -->
